工程-新人练习题

### 目标：

通过新人练习题，让新人熟悉美团技术栈和常用工具。（[常用网站以及权限申请](https://km.sankuai.com/page/35970515)） （预计完成时间：一周）

1. octo服务端，客户端编写
    
2. 熟悉spring框架
    
3. 熟悉cat监控，octo，crane，plus，ops的使用
    
4. 熟悉quake压测
    

### 练习题

**搭建一个thrift工程，提供一个thrift接口。**

**要求**：**1. 代码规范（[**AS代码规范**](https://km.sankuai.com/page/69572452)）、[**新人规范**](https://km.sankuai.com/page/57378191) 2. 压测时间设置为30分钟 3.压测请求分两组一组为 keyword="黑鸭" （返回数据大概439条）， 另外一组keyword="鸡排" & score > 0.3（返回条数大概为8207）**

**说明：可以使用MDP（[**https://mdp.mws.sankuai.com/#/home**](https://mdp.mws.sankuai.com/#/home)）、或者XFrame（[**https://xframe.mws.sankuai.com/**](https://xframe.mws.sankuai.com/)）生成服务代码。**

**完成作业之后 将最佳的压测指标更新wiki：**[最佳压测指标记录](https://km.sankuai.com/page/522173816)

[http://dev.sankuai.com/code/repo-detail/WM/waimai_ad_new_exercises/setting/repo-permission?codeArea=bj](http://dev.sankuai.com/code/repo-detail/WM/waimai_ad_new_exercises/setting/repo-permission?codeArea=bj)  
git 的位置：提交代码到这里

**thrift接口功能：**

1. 根据关键词和条件，从离线词表里检索spuid列表。每个spuid有多个关键字，
    
    1. 比如spuid1：1234532，有3个关键字，肉夹馍（score=5），凉皮（score=3），刀削面（score=5）
        
    2. 比如spuid2：3214532，有2个关键字，肉夹馍（score=3），烤鱼（score=4）
        
    3. 比如spuid3：563459，有2个关键字，重庆小面（score=3），羊肉汤（score=3）
        
    4. 比如关键词是肉夹馍，没有条件，那么应该从词表中的spuid检索出肉夹馍相关的spuid：1234532，3214532
        
    5. 如果关键字是肉夹馍，条件是score>3，那么检索出来的spuid是：1234532
        
2. 支持词表全量更新，使用crane定时任务更新词表，**要求更新文件频率为5分钟**。
    
3. 服务发布必须使用**Plus**进行发布，[https://plus.mws.sankuai.com/#/](https://plus.mws.sankuai.com/#/)
    
4. 使用quake进行压测（ **压测时间设置为30分钟**），**写一个压测报告，并填写到wiki：[**记录最佳压测指标**](https://km.sankuai.com/page/522173816)。（切记！！！）**
    
    1. 使用quake压测thrift接口性能。
        
    2. 使用**cat**和**octo**查看压测的接口性能
        
    3. 完成后，无需释放机器和Appkey。
        
5. 优化过程记录：
    
    1. 做到最好性能，其中涉及到的优化点可以记录下来
        

**appkey：com.sankuai.waimai.d.thrifttest**

**压测机器：**_**set-tx-waimai-a-thrifttest-staging01**_

#### **离线词表地址：**

sankuai@ [set-tx-waimai-a-thrifttest-staging02](mailto:set-tx-waimai-a-ad-staging02@10.54) 目录/home/sankuai/keywords1.txt（**需要申请sankuai权限**）

代码块

Java

ssh set-tx-waimai-a-thrifttest-staging02  

sudo -iu sankuai

scp /home/sankuai/search-keyword/keywords1.txt user@172.18.xxx:/Users/user/Downloads

#### **spring框架 参考代码：**

thrift-demo.zip

178.64KB

#### **词表格式：每一行是一个json字符串格式如下。**

代码块

Shell

{

  "753381170": {// spuid

    "fieldLen": 6,

    "kwScorePos": {

      "黑鸭": { //关键字 

        "optType": 0,//条件

        "pos": 0,//条件

        "score": 0.27259716//条件

      },

      "黑鸭鸭掌": {

        "optType": 0,

        "pos": 0,

        "score": 0.52716404

      },

      "鸭掌": {

        "optType": 0,

        "pos": 2,

        "score": 0.25456688

      },

      "甜辣": {

        "optType": 0,

        "pos": 5,

        "score": 0.29081622

      }

    }

  },

  "753388310": {

    "fieldLen": 4,

    "kwScorePos": {

      "招牌海带": {

        "optType": 0,

        "pos": 0,

        "score": 0.7877002

      },

      "招牌": {

        "optType": 0,

        "pos": 0,

        "score": 0.57598966

      },

      "海带": {

        "optType": 0,

        "pos": 2,

        "score": 0.2117105

      }

    }

  },

  "894283408": {

    "fieldLen": 8,

    "kwScorePos": {

      "复合": {

        "optType": 0,

        "pos": 2,

        "score": 0.2117105

      },

      "气泡果汁": {

        "optType": 0,

        "pos": 4,

        "score": 0.423421

      },

      "复合气泡": {

        "optType": 0,

        "pos": 2,

        "score": 0.423421

      },

      "果汁": {

        "optType": 0,

        "pos": 6,

        "score": 0.2117105

      },

      "蓝莓复合": {

        "optType": 0,

        "pos": 0,

        "score": 0.423421

      },

      "气泡": {

        "optType": 0,

        "pos": 4,

        "score": 0.2117105

      },

      "蓝莓": {

        "optType": 0,

        "pos": 0,、
        

        "score": 0.2117105

      }

    }

  }

}

​



# **八.作业收获**

1.熟悉了公司java项目的开发，一整套服务的构建，部署，上线，跳板机日志查看以及压测

2.熟悉了公司各个生产环境，线下dev环境，线上staging环境

3.熟悉了公司的各种组件的使用，如crane定时任务，lion开关，plus部署平台，octo服务自检，quake全链路压测，jumper跳板机

4.熟悉了性能分析，看火焰图，raptor监控图

5.熟悉了优化知识，如引入本地缓存Cache、jvm调优