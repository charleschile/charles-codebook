关于ivf_index的使用

```sql
create index idx01 using ivfflat on vector_index_09(b) lists=3 op_type "vector_l2_ops";
```



lists 的作用
lists 是 IVF (Inverted File) 索引的一部分，它定义了向量空间被分割成多少个“簇”或“列表”。向量检索时，算法不会遍历整个数据集，而是首先确定向量最接近的簇（列表），然后只在该簇中进行最近邻搜索。分簇的数量越多，搜索的效率通常越高，因为它减少了搜索的空间。具体来说：

IVF原理：在构建索引时，向量会被分配到不同的簇中。检索时，输入向量会被分配到最接近的簇，算法只需在这个簇内搜索相似的向量，而不是在整个数据集中搜索。
lists 参数的含义：lists=5 表示在索引构建时，向量数据被划分为 5 个簇。这有助于提高检索速度，因为在检索时，只需要访问最相似的几个簇中的数据。
确定输入向量属于哪个簇
对于确定输入向量属于哪个簇（也称为list）的过程，通常采用以下方法：

聚类算法（如k-means）：在构建 IVFFLAT 索引时，通常会使用像 k-means 这样的聚类算法来将向量空间划分为多个簇。每个簇的中心点称为质心（centroid）。构建索引时，每个数据点会分配到与其距离最近的质心所对应的簇中。

检索时的簇分配：在检索过程中，输入的查询向量会首先通过向量距离度量（在此案例中是 L2 欧氏距离）计算出它与各个簇的质心之间的距离。向量会被分配到距离最近的质心所对应的簇，随后在该簇中进行具体的相似度检索。

在您的 SQL 查询中：


```sql
select * from vector_index_01 order by  L2_DISTANCE(b, "[16, 15, 0, 0, 5, 46, 5, 5, 4, 0, 0, 0, 28, 118, 12, 5, 75, 44, 5, 0, 6, 32, 6, 49, 41, 74, 9, 1, 0, 0, 0, 9, 1, 9, 16, 41, 71, 80, 3, 0, 0, 4, 3, 5, 51, 106, 11, 3, 112, 28, 13, 1, 4, 8, 3, 104, 118, 14, 1, 1, 0, 0, 0, 88, 3, 27, 46, 118, 108, 49, 2, 0, 1, 46, 118, 118, 27, 12, 0, 0, 33, 118, 118, 8, 0, 0, 0, 4, 118, 95, 40, 0, 0, 0, 1, 11, 27, 38, 12, 12, 18, 29, 3, 2, 13, 30, 94, 78, 30, 19, 9, 3, 31, 45, 70, 42, 15, 1, 3, 12, 14, 22, 16, 2, 3, 17, 24, 13]") ASC LIMIT 2;
```

这条查询通过 L2_DISTANCE 函数计算向量 b 与查询向量之间的欧氏距离，并按距离从小到大排序，返回最近的两个向量。在检索过程中，系统会首先确定查询向量所属的簇，然后在该簇中进行距离计算。

小结
lists 参数：确定了构建 IVF 索引时，将向量划分为多少个簇。簇的数量越多，检索时访问的数据量越少，查询速度越快。
簇的确定：在检索时，输入向量首先会通过 L2 距离计算被分配到最近的簇，然后在该簇中进一步计算具体的相似度并返回结果。


```
SHOW VARIABLES LIKE 'experimental_ivf_index';

```