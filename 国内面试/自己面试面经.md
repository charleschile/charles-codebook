3/25 美团后端一面

redis的主要作用，项目中应用（高频查询和热点数据）

**_热点数据是什么形式放在里面的，什么数据结构_**

使用的是 opsForValue() 方法，它用于操作 Redis 中的 String 类型数据，而不是哈希（Hash）类型。

在您的代码中，您使用了 redisTemplate.opsForValue().set(key, list) 将菜品信息存储在 Redis 中，这表示您的数据结构是将菜品信息以字符串的形式存储在 Redis 中，并使用了一个带有分类 ID 的键。这种存储方式的好处是简单直接，但也有一些限制，例如无法直接对特定字段进行更新，需要先取出整个对象，然后再修改后重新存储。

如果您希望更灵活地操作菜品信息，可以考虑将菜品信息存储为哈希类型。这样，您可以在哈希中存储菜品的各个属性，例如菜品名称、价格、描述等，每个属性都可以单独访问和更新，更加灵活。

商家状态：基于Redis的字符串来进行存储 约定：1表示营业 0表示打烊

**缓存的更新策略 redis和mysql怎么更新**

普通：延迟双删

店铺状态：添加排他锁，它是读写，读读都互斥，这样就能保证在写数据的同时是不会让其他线程读数据的，避免了脏数据。这里面需要注意的是读方法和写方法上需要使用同一把锁才行。

对了，针对「先删除缓存，再更新数据库」方案在「读 + 写」并发请求而造成缓存不一致的解决办法是「延迟双删」。

延迟双删实现的伪代码如下：

#删除缓存

redis.delKey(X)

#更新数据库

db.update(X)

#睡眠

Thread.sleep(N)

#再删除缓存

redis.delKey(X)

加了个睡眠时间，主要是为了确保请求 A 在睡眠的时候，请求 B 能够在这这一段时间完成「从数据库读取数据，再把缺失的缓存写入缓存」的操作，然后请求 A 睡眠完，再删除缓存。

所以，请求 A 的睡眠时间就需要大于请求 B 「从数据库读取数据 + 写入缓存」的时间。

但是具体睡眠多久其实是个玄学，很难评估出来，所以这个方案也只是尽可能保证一致性而已，极端情况下，依然也会出现缓存不一致的现象。

延迟双删有没有问题？--用锁

**_过期时间怎么设置_**

注意惰性删除和定期删除

我是按照访问次数越多，他的过期时间就越长，当然也有一个最高的限制

使用自动过期策略： 利用Redis提供的有序集合（Sorted Set）或有序列表（Sorted List）等数据结构，记录数据的访问频率。然后，根据访问频率动态地调整数据的过期时间。对于热点数据，可以延长其过期时间，而对于非热点数据，则保持较短的过期时间。

redis数据结构，各个数据结构是什么，作用是什么，分别在项目中是怎么用的

redis多个服务器考虑

可以采用redis的集群

**面试官**：Redis分布式锁如何实现 ?

**候选人**：在redis中提供了一个命令setnx(SET if not exists)

由于redis的单线程的，用了命令之后，只能有一个客户端对某一个key设置值，在没有过期或删除key的时候是其他客户端是不能设置这个key的

**面试官**：好的，那你如何控制Redis实现分布式锁有效时长呢？

**候选人**：redis的setnx指令不好控制这个问题，我们当时采用的redis的一个框架redisson实现的。

在redisson中需要手动加锁，并且可以控制锁的失效时间和等待时间，当锁住的一个业务还没有执行完成的时候，在redisson中引入了一个看门狗机制，就是说每隔一段时间就检查当前业务是否还持有锁，如果持有就增加加锁的持有时间，当业务执行完成之后需要使用释放锁就可以了

还有一个好处就是，在高并发下，一个业务有可能会执行很快，先客户1持有锁的时候，客户2来了以后并不会马上拒绝，它会自旋不断尝试获取锁，如果客户1释放之后，客户2就可以马上持有锁，性能也得到了提升。

**面试官**：好的，redisson实现的分布式锁是可重入的吗？

**候选人**：是可以重入的。这样做是为了避免死锁的产生。这个重入其实在内部就是判断是否是当前线程持有的锁，如果是当前线程持有的锁就会计数，如果释放锁就会在计算上减一。在存储数据的时候采用的hash结构，大key可以按照自己的业务进行定制，其中小key是当前线程的唯一标识，value是当前线程重入的次数

**面试官**：redisson实现的分布式锁能解决主从一致性的问题吗

**候选人**：这个是不能的，比如，当线程1加锁成功后，master节点数据会异步复制到slave节点，此时当前持有Redis锁的master节点宕机，slave节点被提升为新的master节点，假如现在来了一个线程2，再次加锁，会在新的master节点上加锁成功，这个时候就会出现两个节点同时持有一把锁的问题。

我们可以利用redisson提供的红锁来解决这个问题，它的主要作用是，不能只在一个redis实例上创建锁，应该是在多个redis实例上创建锁，并且要求在大多数redis节点上都成功创建锁，红锁中要求是redis的节点数量要过半。这样就能避免线程1加锁成功后master节点宕机导致线程2成功加锁到新的master节点上的问题了。

但是，如果使用了红锁，因为需要同时在多个节点上都添加锁，性能就变的很低了，并且运维维护成本也非常高，所以，我们一般在项目中也不会直接使用红锁，并且官方也暂时废弃了这个红锁

缓存穿透

布隆过滤器的底层（是对什么进行哈希的？）误判率

**_除了布隆过滤器还有什么方法可以解决缓存穿透--设置成null_**

缓存空数据，查询返回的数据为空，仍把这个空结果进行缓存

数据量变大怎么办——分库分表、多个数据库（主从）

数据库主从讲一讲

MySQL主从同步原理

**候选人**：MySQL主从复制的核心就是二进制日志(DDL（数据定义语言）语句和 DML（数据操纵语言）语句)，它的步骤是这样的：

第一：主库在事务提交时，会把数据变更记录在二进制日志文件 Binlog 中。

第二：从库读取主库的二进制日志文件 Binlog ，写入到从库的中继日志 Relay Log 。

第三：从库重做中继日志中的事件，将改变反映它自己的数据

乐观锁是什么

怎么实现乐观锁解决超卖的

还有什么方法能解决超卖吗 ——悲观锁解决

分布式锁解决超卖知道吗

**Redis****集群方案？**

**面试官**：Redis集群有哪些方案, 知道嘛 ?

**候选人**：在Redis中提供的集群方案总共有三种：主从复制、哨兵模式、Redis分片集群

**面试官**：那你来介绍一下主从同步

**候选人**：单节点Redis的并发能力是有上限的，要进一步提高Redis的并发能力，可以搭建主从集群，实现读写分离。一般都是一主多从，主节点负责写数据，从节点负责读数据，主节点写入数据之后，需要把数据同步到从节点中

**_Redis_****_分片集群_**

**面试官**：redis的分片集群有什么作用

**候选人**：分片集群主要解决的是，海量数据存储的问题，集群中有多个master，每个master保存不同数据，并且还可以给每个master设置多个slave节点，就可以继续增大集群的高并发能力。同时每个master之间通过ping监测彼此健康状态，就类似于哨兵模式了。当客户端请求可以访问集群任意节点，最终都会被转发到正确节点

**面试官**：Redis分片集群中数据是怎么存储和读取的？

**候选人**：

嗯~，在redis集群中是这样的

Redis 集群引入了哈希槽的概念，有 16384 个哈希槽，集群中每个主节点绑定了一定范围的哈希槽范围， key通过 CRC16 校验后对 16384 取模来决定放置哪个槽，通过槽找到对应的节点进行存储。

取值的逻辑是一样的

怎样分配到不同的redis上去——不仅仅是取模！

**_一致性哈希知道吗？_**

普通哈希会导致增加redis服务器之后取模运算的结果发生很大变化

哈希环 哈希环 取模映射到哈希环上，然后顺时针查找这个值

这样会导致再增加一个服务器之后，只会有一小部分失效

用虚拟节点（解决哈希偏斜）

缓存读写->虚拟节点->真实节点->真正读写

讲一讲登录是怎么做的？

为什么用jwt

**_SSO_****_了解吗？_**

单点系统

正常：服务端会记录用户的session，同时我们会把cookie写入到浏览器中，每次请求都会带上cookie，服务端能通过这个cookie找到对应的session，通过session来判断用户是否登录

nginx负载均衡怎么做的？如何用多台服务器做负载均衡的

微服务了解吗？

**_Rpc_****_（remote procedure call 远程过程调用，调用方法）了解吗？_**

http和rpc协议都是应用层的协议，都是基于tcp衍生而来的

tcp基于字节流是会有粘包的，消息头规定长短来解决这个问题

rpc就是想像调用本地方法一样取调用远端的方法，对于自己的软件想要连接自己家的服务器请求数据就可以是使用rpc

数据库索引是什么，索引的作用是什么

索引的结构是什么

B+树的好处

聚簇索引与非聚簇索引

覆盖索引了解吗

最左前缀匹配了解吗

最左匹配原则中使用通配符

数据库的缓冲池是怎么实现的？

数据库缓存更新的lru-k算法介绍一下

AOP了解吗，好处是什么？

解耦

通过动态代理的方式，将需要注入切面的对象进行代理，在运行的时候，只要将公共的逻辑就加进去

AOP怎么实现的？

动态代理了解吗？

算法：重排链表

反问：

实习生在你们部门会做哪些工作

实习时长，开始时间

一面结果什么时候可以知道

评价一下面试表现，可以改进的地方

对于java的学习有没有建议

部门hc多不多

Tcp timewait

多态底层是怎么实现的

类加载的原理

Jvm如何和外部进程通信

静态方法能调用动态类吗   为什么？

**_Redis_****_为什么用，不用mysql，不止缓存热点，mysql缓存不能用吗_**

**_读写速度：Redis 是一个内存数据库，对数据的读写速度远超过基于磁盘的数据库系统如 MySQL。_**

**_而 MySQL 的缓存主要针对查询结果，其灵活性和适用场景相对有限。_**

**_水平扩展：Redis 设计之初就考虑了高可扩展性，可以通过集群来实现数据的分片和复制，这为处理大规模数据提供了方便。MySQL 作为传统的关系数据库，其水平扩展相对复杂，主要依赖于分库分表等策略，而其内置的缓存机制并不直接支持这种扩展。_**

多路复用

Java 基础volatile：单例模式为什么锁住了还用volatile

缓存一致性：延迟双闪和先更新在删除

用分布式锁是什么，一定能锁住吗

宕机

Redis集群

Redis IO多路复用

Time wait状态：Udp没有 socket 有connect吗？怎么通过状态连接呢为什么无状态还能连接

文件系统：Linux命令在5000行的文件中输出第100行-》给出具体实现

Mysql索引

主键索引和二级索引key一定是一样吗

算法：字符串子序列

垃圾回收：复制算法地址会改变吗

为什么转到计算机？

**有哪些排序算法（各自时间复杂度是多少）**

**进程和线程的区别**

**进程间的通信有哪些**

**Tcp****三次握手和四次挥手**

**为什么要三次握手和四次挥手**

**挑一个项目讲一下**

**介绍这个数据库**

**缓冲池是怎么设计的**

**B+****树索引的结构**

**怎么实现叶子节点的合并和分裂的**

**具体的结构体实现是怎么样的**